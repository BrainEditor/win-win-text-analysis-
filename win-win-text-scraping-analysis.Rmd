---
title: "winwin text analysis"
author: "AJ Caughey"
date: "5/29/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
library(rvest)
library(magrittr)
library(data.table)
library(lubridate)
library(xml2)
library(purrr)
library(tidyr)
library(tidyverse)
library(ggthemes)
library(png)
```

In this branch, I'm just using the text data I scrape back in August 2020. I load that in below.

```{r loading in data}

gongying <- read.csv("win_win_cleaned_data2.csv", encoding = "UTF-8")

chinachart_logo <- readPNG("china_charts_logo.png")

```



# Cleaning Up Our Scraped Data

This is a good start, but the data is still pretty messy. We'll need to take out some of the junk text in the key words variable, clean up the dates to make sure they are in a standard format, and drop the standard shared keyword tag.

It would also be helpful to create three separate columns for keywords 1, 2, and 3. Some of these will have NA values if there's only one or two associated keywords with the article, but that's fine. 

Each keyword is separated by a space, so we'll use this to our advantage. 



We've cleaned dates, now we use some of the same tools to clean up keywords. 

Remember, we want to make multiple columns for each key word. Keywords are seperated by spaces. 

I'll also save the raw, uncleaned data-frame on my local machine, so that we don't have to keep sending a ton of requests to the online archive. That way, when working on this project in the future, we can just reference the data we've already scraped, rather than re-scraping every time. 



\newpage 

# Data Analysis (finally!)

## Analyzing Usage Over Time 

Now we can start doing the actual analysis!

Let's start by looking first at how usage of gongying has change over time. 

After we get a sense of change over time, we can break it down and look at keywords. 

A note about gongying - including both article text and headlines, there are only 13 mentions of this word from 1946 until 2000, thats out of 12919 results in total. 


I'll also plot they keyword usage over time. 



```{r exploring}

##cc version
cc_winwin_over_time <- gongying %>% 
  group_by(years) %>% 
  summarise(total_mentions = n()) %>% 
  filter(years != "2020") %>%
  ggplot(aes(x = years, y = total_mentions)) + 
  geom_bar(stat = "identity", fill = "#004374") + 
#theming
  theme_wsj() +
    theme(text = element_text(size = 7)) +
  scale_x_continuous(breaks = 2000:2019) +
  ggtitle("'Win-Win' Diplomacy in State Media") +
  labs(subtitle = "People's Daily Headlines With 'Win-Win'") +
  ylab("Articles with 'Win-Win' in Headline") +
  xlab("") +
  theme(legend.position="none", plot.title = element_text(size = 9, 
                                                          face = "bold"),
        plot.subtitle = element_text(size = 8), 
        axis.title.y = element_text(color = "#000001", size=7, 
                                    vjust=.9, face = "bold"),
        axis.title.x = element_text(color = "#000001", size=7, 
                                    vjust=.9, face = "bold"),
        axis.text.x = element_text(color="#000001", 
                           size=6, face = "bold")) + 
  guides(fill=guide_legend(title="")) +
  labs(caption = c("©ChinaCharts", 
                   "Source: People's Daily Database")) +
  theme(plot.caption = element_text(hjust=c(1, 0), face =c("plain", "italic"), 
                                  size = 6))
#logo
cc_winwin_over_time <- cc_winwin_over_time
grid::grid.raster(chinachart_logo, x=.86, y=.82, just = c('left', 'bottom'), 
                  width = unit(1, 'inches')) 

ggsave("cc_winwin_over_time.png", cc_winwin_over_time)  

```

\newpage 

# Common Themes: Keyword Tag Analysis 


What keywords are used most often in articles about gongying? We can use the article tags from the archive to get a better sense of this. 

This will be a bit tricky to work with, since I need to count observations that are split across 4 different columns. To do so, I created three summary vectors, joined them into a dataframe, and used ifelse statements to count how many times each term was used.  

In the future, I could improve upon this code by creating a function and iterating that over the respective columns to cut down on copied text 

```{r #top keywords all time}
common_keys_1 <- gongying %>%
  group_by(tag_1) %>% 
  summarise(count = n()) 

commong_keys_2 <- gongying %>%
  group_by(tag_2) %>% 
  summarise(count = n()) 

common_keys_3 <- gongying %>%
  group_by(tag_3) %>% 
  summarise(count = n()) 

#stiching each column together into one dataframe 
key_word_totals <- full_join(common_keys_1, commong_keys_2, by = c("tag_1" = "tag_2")) %>% 
  full_join(common_keys_3, by = c("tag_1" = "tag_3")) %>%
  #counting up usage all time, ignoring NAs 
  mutate(count.x = ifelse(!is.na(count.x), count.x, 0), 
         count.y = ifelse(!is.na(count.y), count.y, 0), 
         count = ifelse(!is.na(count), count, 0), 
         total_mentions = count.x + count.y + count,
        #ranking all time
         rank = rank(-total_mentions)) %>%
    rename("tag" = tag_1) %>% 
  select(tag, total_mentions, rank) %>% 
  arrange(desc(rank))
```

We have a sense of the most frequently used keywords for gongying, but we don't know if usage of these keywords has changed over time. 

We'll modify our code slightly to group by years, and create a dataframe that counts usage by year. 

```{r keywords over time}
#keywords over time
common_keys_1_years <- gongying %>%
  group_by(tag_1, years) %>% 
  summarise(count = n()) %>%
  mutate(id = str_c(tag_1, years)) 

commong_keys_2_years <- gongying %>%
  group_by(tag_2, years) %>%        
  summarise(count = n()) %>%
  mutate(id = str_c(tag_2, years)) 

common_keys_3_years <- gongying %>%
  group_by(tag_3, years) %>% 
  summarise(count = n()) %>%
  mutate(id = str_c(tag_3, years)) 

#stiching each column together into a dataframe
key_word_totals_yearly <- left_join(common_keys_1_years, commong_keys_2_years, by = "id")
key_word_totals_yearly <- left_join(key_word_totals_yearly, common_keys_3_years, by = "id") %>%
  #counting up usage per year, ignorning NAs
  mutate(count.x = ifelse(!is.na(count.x), count.x, 0), 
         count.y = ifelse(!is.na(count.y), count.y, 0), 
         count = ifelse(!is.na(count), count, 0), 
         total_mentions = count.x + count.y + count,
         #ranking 
         rank = as.integer(rank(-total_mentions))) %>% 
    rename("tag" = tag_1, "year" = years.x) %>% 
  select(tag, year, total_mentions, rank) %>% 
  arrange(desc(total_mentions)) 
```

Currently, all our country names and keywords are in Chinese. To make this more legible for an English speaking audience, we'll convert these to English below. Rather than translating every country, however, we'll just do this for the most frequently mentioned terms and countries.


```{r plotting keyword analysis}

#lets look at the top 20 
common_keys <- key_word_totals %>% 
  filter(!is.na(tag)) %>% 
  filter(total_mentions >= 15)


#need english to show on ggplot 
english_common_keys <- c( 
"China",
"Dialogue",
"Adhere/Support",				
"Shared Development",				
"Culture",
"Initiative",
"Market",
"Peace",
"Investment",
"Innovation",
"International",
"Summit meeting",
"Sino-US relations",				
"Business",
"Economy",
"Construct/Construction",
"win-win",				
"Mutual benefit",
"Belt and Road",
"Cooperation") %>%
  as.data.frame()


common_keys <- english_common_keys %>%
  select('.') %>% 
  cbind(common_keys) %>% 
  rename("tag_english" = '.') %>%
  select(tag, tag_english, total_mentions, rank)


#common_keys <- cbind(common_keys, english_common_keys) %>% 
#  rename("tag_english" = english_common_keys) %>%
#  select(tag, tag_english, total_mentions, rank)

```

\newpage 

## Plotting Commonly Used Keys 

Now that we have our most commonly used keywords, lets visualize them to see what jumps out. 

It will be easier to compare frequency for each term if we take our bar chart and flip it sideways, then arrange terms from most commonly used to least commonly used. I also add in a color gradient to make these differences more clear. Since all of the terms are commonly used, I use green for each (implying they are all frequently used), but just scale the green color to make the difference in popularity more apparent. 

```{r visualizing most common keys}

##revised @chinacharts aesthetic
cc_common_topics_plot <- common_keys %>% 
  filter(tag_english != "China" , tag_english != "Adhere/Support" , 
         tag_english != "win-win" , tag_english != "Cooperation", 
         tag_english != "Mutual benefit") %>% 
  ggplot(aes(x = reorder(tag_english, total_mentions), y = total_mentions, 
             fill = "#FF6666")) + 
  geom_bar(stat = "identity") +
  #easy to compare vertically in descending order
  coord_flip() +
   #clean up labels, more legible
  labs(subtitle = "Top Associations: Development & Diplomacy") +
 #scale_fill_economist(low = "lightgreen", high= "darkgreen") +
  theme_wsj() +
    theme(text = element_text(size = 7)) +
  ggtitle("How Does State Media Use the Term 'Win-Win'?") +
  xlab("Tagged Article Topics") +
    ylab("People's Daily Articles With 'Win-Win' in The Headline") +
  scale_y_continuous() +
  scale_fill_economist() +
  theme(legend.position="none", plot.title = element_text(size = 9, 
                                                          face = "bold"),
        plot.subtitle = element_text(size = 8), 
        axis.title.y = element_text(color = "#000001", size=7, 
                                    vjust=.9, face = "bold"),
        axis.title.x = element_text(color = "#000001", size=7, 
                                    vjust=.9, face = "bold"),
        axis.text.x = element_text(color="#000001", 
                           size=6, face = "bold")) + 
  guides(fill=guide_legend(title="")) +
  labs(caption = c("©ChinaCharts", 
                   "Source: People's Daily Database, 2000 - 2020")) +
  theme(plot.caption = element_text(hjust=c(1, 0), face =c("plain", "italic"), 
                                  size = 6))

cc_common_topics_plot <- cc_common_topics_plot
grid::grid.raster(chinachart_logo, x=.86, y=.82, just = c('left', 'bottom'), 
                  width = unit(1, 'inches')) 

ggsave("china_charts_common_topics.png", cc_common_topics_plot)  

```

The chart above is useful, it tells us what topics win-win is generally applied to. 

However, what if we want to see how the most common topics usage changed over time? This is easier to visualize with geom_line. We'll look at just the most frequently used terms here. 

It's clear that Belt and Road came to dominate over time, perhaps subsuming the more general "business" and "economy" categories. In line with the larger trends, we see that usage dropped off  in 2018, but has quite quickly rebounded. 


```{r important key trends over time}

#get our common keys in English
english_common_keys <- common_keys %>% 
  select(tag, tag_english) 

#join with English translation, and keep only most commonly used
important_keys_over_time <- left_join(key_word_totals_yearly, 
                                      english_common_keys, by = "tag") %>% 
  select(tag, tag_english, year, total_mentions) %>% 
  filter(tag_english == "Belt and Road" | 
           tag_english == "Construct/Construction" | 
         tag_english == "Economy" | 
           tag_english == "Sino-US relations" | 
           tag_english == "Business") 
#exclude current year
  #filter(year != "2020")

##themeing for China charts 
cc_important_topics_yearly <- important_keys_over_time %>%
  filter(year != "2020", 
         tag_english == "Belt and Road" | 
           tag_english == "Business" | 
           tag_english == "Economy" | 
           tag_english == "Sino-US relations" | 
           tag_english == "Construct/Construction") %>% 
  mutate(tag_english = ifelse(tag_english == "Construct/Construction", 
                                 "Construction", 
                              tag_english)) %>%
  mutate(tag_english = ifelse(tag_english == "Business" | 
                                 tag_english == "Economy", 
                               "Business/Economy", tag_english)) %>%
ggplot((aes(x=year, y=total_mentions, color = tag_english))) + 
  geom_smooth(span = .88, size = 1.6, se = F) +
  #clean up labels, more legible
  labs(title = "How Did 'Win-Win' Usage Change For Frequent Topics?",
       color = "Article Topics") +
  xlab("year") +
  ylab("People's Daily Headlines Including 'Win-Win'") + 
  #change our scale so each year is shown 
  scale_x_continuous(breaks = seq(2000, 2019, 1)) +
  theme_wsj() +
    theme(text = element_text(size = 7)) +
  ggtitle("How Has State Media's Coverage of 'Win-Win' Diplomacy Changed Over Time?") +
  labs( subtitle = "Though Once Central to BRI Messaging, Usage Fell After 2017 Peak") +
  scale_y_continuous() +
  scale_color_economist() +
  theme(legend.text = element_text(size = 7.5),
        legend.title = element_text(size = 8), 
        plot.title = element_text(size = 9, face = "bold"),
        plot.subtitle = element_text(size = 8), 
        axis.title.y = element_text(color = "#000001", size=7, 
                                    vjust=1.9, face = "bold"), 
        axis.text.x = element_text(color="#000001", 
                           size=6, angle=345, face = "bold")) + 
  guides(fill=guide_legend(title="")) +
  labs(caption = c("©ChinaCharts", 
                   "Source: People's Daily Database     2000 - 2019")) +
  theme(plot.caption = element_text(hjust=c(1, 0), face =c("plain", "italic"), 
                                  size = 6))

cc_important_topics_yearly <- cc_important_topics_yearly
grid::grid.raster(chinachart_logo, x=.86, y=.82, just = c('left', 'bottom'), 
                  width = unit(1, 'inches')) 

ggsave("china_charts_important_topics_yearly.png", cc_important_topics_yearly)  

```
\newpage

# Understanding "win-win" Usage by Country


We have a better understanding of how win-win rhetoric has been applied to specific thems over time, but what countries is it most commonly associated with? In other words, where in the world is this term being frequently used? 

Further, are key terms and themes more commonly used in some countries than others? 

Let's start to answer those questions. 

## Cleaning for Country Analysis

It's clear that many of the keywords are actually bilaterial relationship or regional relationships. That's pretty interesting and worth further exploration. 

Where is "win-win" cooperation most often mentioned? 

If we clean the data a little bit more, we can start to answer this question. We'll need to extract the country name from the keyword tag using a regular expression, and then count up how many times each country is mentioned across columns. 

Again, if we just slightly modify our previous code, we can count these mentions pretty easily. In the future, though, it'd be better to write a generalized function that cuts down on copy pasted text. 
```{r extract "guanxi"}

#this section removes anything before guanxi 
#most of these entries are bilateral relations witha  country. if we include them as a new category
#how does the data change? 

#new dataframe to work with this question so I don't mess previous df up 
gongying_bilat <- gongying

gongying_bilat$tag_1 <- str_replace(gongying$tag_1, "中.*关系$", "关系")
gongying_bilat$tag_2 <- str_replace(gongying$tag_2, "中.*关系$", "关系")
gongying_bilat$tag_3 <- str_replace(gongying$tag_3, "中.*关系$", "关系")

#make vectors that count mentions over time
#create a unique id to facilitate joining later

common_keys_1_years_bilat <- gongying_bilat %>%
  group_by(tag_1, years) %>% 
  summarise(count = n()) %>%
  #create the id
  mutate(id = str_c(tag_1, years)) 

commong_keys_2_years_bilat <- gongying_bilat %>%
  group_by(tag_2, years) %>% 
  summarise(count = n()) %>%
  mutate(id = str_c(tag_2, years)) 

common_keys_3_years_bilat <- gongying_bilat %>%
  group_by(tag_3, years) %>% 
  summarise(count = n()) %>%
  mutate(id = str_c(tag_3, years)) 


#totals all time
key_word_totals_bilat <- full_join(common_keys_1, commong_keys_2, 
                                   by = c("tag_1" = "tag_2")) %>% 
  full_join(common_keys_3, by = c("tag_1" = "tag_3")) %>% #join all three together
  #count mentions across columns
  mutate(count.x = ifelse(!is.na(count.x), count.x, 0), 
         count.y = ifelse(!is.na(count.y), count.y, 0), 
         count = ifelse(!is.na(count), count, 0), 
         total_mentions = count.x + count.y + count,
         #rank most mentioned countries
         rank = rank(-total_mentions)) %>%
    rename("tag" = tag_1) %>% 
  select(tag, total_mentions) %>% 
  #rearrange with key variables only
  arrange(desc(total_mentions)) 

#yearly totals over time
key_word_totals_yearly_bilat <- left_join(common_keys_1_years_bilat, 
                                          commong_keys_2_years_bilat, 
                                          by = "id") %>%
  left_join(common_keys_3_years_bilat, by = "id") %>%
  mutate(count.x = ifelse(!is.na(count.x), count.x, 0), 
         count.y = ifelse(!is.na(count.y), count.y, 0), 
         count = ifelse(!is.na(count), count, 0), 
         total_mentions = count.x + count.y + count,
         rank = as.integer(rank(-total_mentions))) %>% 
    rename("tag" = tag_1, year = years.x) %>% 
  select(tag, years, total_mentions, rank) %>% 
  arrange(desc(total_mentions)) 
```

Our data is still in Chinese and doesn't have an English translation for readers. I'll again take the most frequently used countries and provide an English translation. 


```{r bilaterial country analysis}

#creating larger group for africa 
key_word_totals_bilat_africa <- key_word_totals_bilat

key_word_totals_bilat_africa$tag <- str_replace(key_word_totals_bilat$tag, ".*中非.*", "中非关系") 

africa_total_mentions <- key_word_totals_bilat_africa %>% 
  summarise(total_mentions = sum(ifelse(tag == "中非关系", total_mentions, 0), na.rm = TRUE)) %>% 
  mutate(tag = "中非关系") %>% 
  select(tag, total_mentions)

key_word_totals_bilat_africa$tag <- str_replace(key_word_totals_bilat$tag, ".*中非.*", "africa") 


bilat_africa_country_summary <- key_word_totals_bilat_africa %>% 
  filter(str_detect(tag, '关系')) %>% 
  rbind(africa_total_mentions) 
  
english_country_keys <- c(
  "US",				
"Germany", 
"International relations",
"India",
"France",
"Japan",
"Kazakhstan",
"Latin America",
"Korea", 
"Arab", 
"Russian",
"Pakistan",
"Europe",
"Myanmar",
"Zambia",
"Greece",
"Switzerland", 
"Sino-Vietnamese", 
"Nepal",
"Romania",
"Great powers",
"West",
"South Africa",
"Economic relations",
"Cross-Strait Economy",
"Rwanda",
"EU", 
"Poland",
"Soviet",
"Partnerships",
"Croatia",
"Cyprus",
"Cambodia",
"Australia",
"Belarus",
"Jordan",
"Mozambique", 
"Mexico", 
"Strategic partnership",
"Political", 
"Kyrgyzstan", 
"Buddhist",
"Austria",
"Victoria",
"Singapore",
"Thailand",
"Finland",
"Mongolia", 
"Africa") 
```

\newpage

## Visualizing Win-Win Usage by Country 

With cleaned data and English translations, we're ready to show how usage varies by country. We'll start by inspecting the total mentions in the most common countries for all-time. 

```{r visualizing win win usage by country}
bilat_africa_country_summary <- cbind(bilat_africa_country_summary, english_country_keys) %>% 
    rename("tag_english" = english_country_keys) %>%
  select(tag, tag_english, total_mentions) 

```


```{r cc bilateral summary plot}
#plot data 

cc_bilat_summary_plot <- bilat_africa_country_summary  %>% 
  filter(total_mentions >= 5, tag_english != "International relations") %>% 
  ggplot(aes(x = reorder(tag_english, total_mentions), y = total_mentions)) + 
  geom_bar(stat = "identity", fill = "#004374") +
  coord_flip() +
  #set color gradient manually to better fit
  scale_fill_gradient(low = "lightgreen", high = "darkgreen") +
  #intuitive labels/titles
  ylab("People's Daily Headlines Including 'Win-Win'") +
  theme(axis.text.x=element_text(angle = -90, hjust = .05)) +
  #build aesthetic style on existing theme
 theme_wsj() +
    theme(text = element_text(size = 7)) +
  ggtitle("Where Does China Search for Win-Wins?") +
  labs(subtitle = "Mostly in Developed Countries & Regions with BRI Partners") +
  scale_y_continuous() +
  scale_color_economist() +
  theme(axis.title.x = element_text(color = "#000001", size=7, 
                                    vjust=1.9, face = "bold"), 
        legend.text = element_text(size = 7.5),
        legend.title = element_text(size = 8), 
        plot.title = element_text(size = 9, face = "bold"),
        plot.subtitle = element_text(size = 8), 
        axis.title.y = element_text(color = "#000001", size=7, 
                                    vjust=1.9, face = "bold"), 
        axis.text.x = element_text(color="#000001", 
                           size=6, face = "bold")) + 
  guides(fill=guide_legend(title="")) +
  xlab("Article Topic: China's Relationship With...") +
  labs(caption = c("©ChinaCharts", 
                   "Source: People's Daily Database     2000 - 2020")) +
  theme(plot.caption = element_text(hjust=c(1, 0), face =c("plain", "italic"), 
                                  size = 6))

cc_bilat_summary_plot <- cc_bilat_summary_plot
grid::grid.raster(chinachart_logo, x=.86, y=.82, just = c('left', 'bottom'), 
                  width = unit(1, 'inches')) 

ggsave("cc_bilat_summary_plot.png", cc_bilat_summary_plot)  

```

Though we now know where win-win rhetoric is frequently used, we'd like to know more about what kinds of policies are being discussed as potential "win-wins". Given that the Belt and Road is such a focal point for "win-win" coverage, it seems likely that non-BRI countries are discussed in the same language as BRI countries. How, then, does the coverage of Sino-African relations differ from, say, Japan and Germany? 

To get a sense of this, we'll need to find articles tagged with either Japan, Germany, or Africa, and then group by country and find the most commonly discussed topics mentioned for each country/region. There's likeley to be some differences between the two. 

In the future, I could improve on this by creating a bucket that includes all African countries alongside the "Sino-African Relations" tag that's used by the archive. For now, though, this works as a good first-cut. 


```{r key regions analysis}


#new dataframe with africa relationships recoded
gongying_dev_country <- gongying
gongying_dev_country$tag_1 <- str_replace(gongying$tag_1, ".*中非.*", "中非关系") 
gongying_dev_country$tag_2 <- str_replace(gongying$tag_2, ".*中非.*", "中非关系") 
gongying_dev_country$tag_3 <- str_replace(gongying$tag_3, ".*中非.*", "中非关系") 

#mutate for binary variables indicating region of interest
#we need to look across all three columns for the country tag
germany_japan_africa <- gongying_dev_country %>% 
  mutate(country = 
           #articles focused on Germany
           ifelse(str_detect(gongying_dev_country$tag_1, 
                             pattern = "中德关系") == TRUE,
                                "Germany",
                          ifelse(str_detect(gongying_dev_country$tag_2,
                                            pattern = "中德关系") == TRUE,
                                "Germany",
                                ifelse(str_detect(gongying_dev_country$tag_3,
                                                  pattern = "中德关系") == TRUE,
                                "Germany", 0))), 
         #articles on Japan
         country = ifelse(str_detect(gongying_dev_country$tag_1,
                                     pattern = "中日关系") == TRUE,
                                "Japan",
                          ifelse(str_detect(gongying_dev_country$tag_2,
                                            pattern = "中日关系") == TRUE,
                                "Japan",
                                ifelse(str_detect(gongying_dev_country$tag_3,
                                                  pattern = "中日关系") == TRUE,
                               "Japan", country))),
         #articles on Africa
         country = ifelse(str_detect(gongying_dev_country$tag_1,
                                     pattern = "中非关系") == TRUE,
                                "Africa",
                          ifelse(str_detect(gongying_dev_country$tag_2,
                                            pattern = "中非关系") == TRUE,
                                "Africa",
                                ifelse(str_detect(gongying_dev_country$tag_3,
                                                  pattern = "中非关系") == TRUE,
                               "Africa", country)))) %>% 
  filter(!is.na(country), country != "0") 

#we create a summary for each column of keywords
gja_common_topics_1 <- germany_japan_africa %>%
  group_by(country, tag_1) %>% 
  summarise(count = n()) 

gja_common_topics_2 <- germany_japan_africa %>%
  group_by(country, tag_2) %>% 
  summarise(count = n()) 

gja_common_topics_3 <- germany_japan_africa %>%
  group_by(country, tag_3) %>% 
  summarise(count = n())

#join those three summary columns together, and create ranked totals for all time
gja_topics_totals <- full_join(gja_common_topics_1, gja_common_topics_2, 
                               by = c("country", "tag_1" = "tag_2")) %>% 
  full_join(gja_common_topics_3, by = c("country", "tag_1" = "tag_3")) %>% 
  #counting mentions across each column
   mutate(count.x = ifelse(!is.na(count.x), count.x, 0), 
         count.y = ifelse(!is.na(count.y), count.y, 0), 
         count = ifelse(!is.na(count), count, 0), 
         total_mentions = count.x + count.y + count,
  #ranking key variables and arranging in descending order
         rank = rank(-total_mentions)) %>%
    rename("tag" = tag_1) %>% 
  select(country, tag, total_mentions, rank) %>% 
  arrange(country, rank) 
```

These keywords are all still in Chinese, so once again we'll take the most frequently mentioned topics in each region and translate them into English.

```{r english bilaterial relations}

#we need an english key to graph this, lets get all unique tags first 

gja_tag_english <- c(
"China-Africa relations",
"Win-Win",				
"Develop together",				
"Friendship",
"Mutual benefit",
"China",
"Business",
"Community of Destiny",
"Neocolonialism", 
"Access",
"Commentator",
"Africa-China Cooperation",
"Policy",
"Economy",
"Economic and Trade Cooperation",				
"Condemn",  
"Sino-German relations",
"Cooperation",				
"Business", 
"Mutual benefit", 
"Make a big cooperation cake",
"Chinese Dream", 
"win-win", 
"Innovation", 
"Friendship",
"Preh Automotive Company",
"Investment",
"EU",  
"China-Japan Relationship",
"Cooperation",
"Exchange",
"Expand Reopening",				
"China Korea Relationship",
"Mutual benefit", 
"Meeting",
"win-win",
"Dialouge") 

```


```{r join english topics to mandarin, eval=FALSE}

#add english to dataframe 
gja_topics_totals_english <- gja_topics_totals %>%
  cbind(gja_tag_english) %>% 
  #clean up names
  rename("tag_english" = '...5') %>%
  #keep only what we need 
  select(country, tag, total_mentions, rank, tag_english)
```

\newpage 

## Visualizing "win-win" policy areas in Germany, Japan, and Africa 

It will be easier for us to contrast all three areas if we lay out each grid on a faceted grid. We can again use bar charts to see how total mentions vary. 


We see here that topics highlighted vary greatly from region to region. In Africa, coverage highlights mutual economic development, while in Germany the focus is on businessand investment. In contrast, Japan's win-win coverage has a more nebulous, vague focus that expresses general goodwill but few specifics. 

```{r plotting bilateral win-win topics, eval=FALSE}

#plotting
cc_gja_topics_totals_english <- gja_topics_totals_english  %>% 
  #filter out redundant synonyms or little-used phrases
 filter(tag_english != "China-Africa relations",
        tag_english != "Sino-German relations", 
        tag_english != "China-Japan Relationship", 
        tag_english!= "Win-Win", 
        tag_english!= "win-win", 
        tag_english != "Mutual benefit",
        tag_english != "Policy", 
        tag_english != "Make a big cooperation cake", 
        tag_english != "EU", 
        tag_english != "China", 
        tag_english != "Africa-China Cooperation", 
        tag_english != "China dream",
        tag_english != "Commentator", 
        tag_english != "Cooperation") %>% 
  #combine economy and trade into a common tag 
  mutate(tag = ifelse(tag == "经济", "经贸合作", tag), 
         tag_english = ifelse(tag == "经贸合作", 
                              "Economic and Trade Cooperation",
                              tag_english)) %>%
#begin plotting 
  ggplot(aes(x = reorder(tag_english, total_mentions), y = total_mentions,
             fill = total_mentions)) + 
  geom_bar(stat = "identity", fill = "#004374") +
  facet_grid(~country) +
  coord_flip() +
  #set color gradient manually to better fit
  scale_fill_gradient(low = "lightgreen", high = "darkgreen") +
  #intuitive labels/titles
  labs(subtitle = "Developmental With Africa, Businesswith Germany, Dialouge with Japan") +
  ylab("Total Articles") + 
   theme_wsj() +
    theme(text = element_text(size = 7)) +
  ggtitle("How do Win-Win Article Key Topics Differ for Germany, Japan, and Africa?") +
  scale_y_continuous(breaks = c(1:20)) +
  scale_color_economist() +
  theme(strip.text = element_text(size = 10),
        axis.title.x = element_text(color = "#000001", size=7, 
                                    vjust=1.9, face = "bold"), 
        legend.text = element_text(size = 7.5),
        legend.title = element_text(size = 8), 
        plot.title = element_text(size = 9, face = "bold"),
        plot.subtitle = element_text(size = 8), 
        axis.title.y = element_text(color = "#000001", size=7, 
                                    vjust=4, face = "bold"), 
        axis.text.x = element_text(color="#000001", 
                           size=6, face = "bold")) + 
  guides(fill=guide_legend(title="")) +
  labs(caption = c("©ChinaCharts", 
                   "Source: People's Daily Database   2000 - 2020")) +
  theme(plot.caption = element_text(hjust=c(1, 0), face =c("plain", "italic"), 
                                  size = 6)) +
  xlab("Article Topic Associated Keyword")

cc_gja_topics_totals_english <- cc_gja_topics_totals_english
grid::grid.raster(chinachart_logo, x=.16, y=.82, just = c('left', 'bottom'), 
                  width = unit(1, 'inches')) 


ggsave("cc_gja_topics_totals_english.png", cc_gja_topics_totals_english)  

```

